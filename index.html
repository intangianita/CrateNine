<script>
const envelopeContainer = document.getElementById('envelopeContainer');
const envelope = document.getElementById('envelope');
const letter = document.getElementById('letter');
const scrollIndicator = document.getElementById('scrollIndicator');
const instructions = document.querySelector('.instructions');
const bgMusic = document.getElementById('bgMusic');
const popSound = document.getElementById('popSound');

let isOpened = false;
let letterHeight = 0;
let maxLetterHeight = 0;
let bgStarted = false;
let scrollTimeout;
let instructionTimeout;

// buka amplop
function openEnvelope() {
  envelope.classList.add('opened');
  letter.classList.add('pop-up');
  setTimeout(() => letter.classList.add('content-visible'), 300);
  try { popSound.currentTime = 0; popSound.play(); } catch(e){}
  if (!bgStarted) { bgStarted = true; bgMusic.play().catch(() => {}); }
  isOpened = true;

  // tinggi maksimal surat
  maxLetterHeight = letter.scrollHeight;
  letterHeight = 0;
  letter.style.height = `${letterHeight}px`;

  // tampilkan scroll-indicator dan instructions
  showScrollIndicator();
  showInstructions();
}

// tutup amplop
function closeEnvelope() {
  letter.classList.remove('content-visible');
  letter.classList.remove('pop-up');
  letterHeight = 0;
  letter.style.height = `0px`;
  scrollIndicator.classList.remove('visible');
  instructions.classList.remove('visible');
  setTimeout(() => { envelope.classList.remove('opened'); try { popSound.currentTime = 0; popSound.play(); } catch(e){} }, 300);
  isOpened = false;
}

// tampilkan scroll-indicator
function showScrollIndicator() {
  scrollIndicator.classList.add('visible');
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => scrollIndicator.classList.remove('visible'), 1800);
}

// tampilkan instructions
function showInstructions() {
  instructions.classList.add('visible');
  clearTimeout(instructionTimeout);
  instructionTimeout = setTimeout(() => instructions.classList.remove('visible'), 1800);
}

envelopeContainer.addEventListener('click', () => {
  if (isOpened) {
    closeEnvelope();
  } else {
    openEnvelope();
  }
});

// scroll untuk mengangkat/menurunkan surat
document.addEventListener('wheel', function(e) {
  if(!isOpened) return;
  e.preventDefault();

  showScrollIndicator();
  showInstructions();

  const delta = e.deltaY;
  letterHeight -= delta * 0.5;
  letterHeight = Math.max(0, Math.min(maxLetterHeight, letterHeight));
  letter.style.height = `${letterHeight}px`;

  if(letterHeight <= 0) closeEnvelope();
}, { passive:false });

// floating hearts
function createHeart() {
  const heart = document.createElement('div');
  heart.className = 'heart';
  heart.innerText = '❤️';
  heart.style.left = Math.random()*(window.innerWidth-40)+'px';
  heart.style.top = window.innerHeight+'px';
  heart.style.fontSize = (12+Math.random()*28)+'px';
  document.body.appendChild(heart);
  setTimeout(()=>heart.remove(),7000);
}
setInterval(createHeart,600);
</script>
